python3 << 'PYEOF'
with open('web/app.js', 'w') as f:
    f.write("""// RadarApp - Ajo/Esusu Web Application\nwindow.addEventListener('load',()=>{checkAuthStatus();initializeApp()});const checkAuthStatus=()=>{const user=firebase.auth().currentUser;if(user){showPage('home');loadUserData()}else{showPage('login')}};const initializeApp=()=>{document.getElementById('signup-form').addEventListener('submit',handleSignup);document.getElementById('login-form').addEventListener('submit',handleLogin);document.getElementById('logout-btn').addEventListener('click',handleLogout);document.getElementById('deposit-form').addEventListener('submit',handleDeposit);document.getElementById('contribution-form').addEventListener('submit',handleContribution);document.getElementById('loan-form').addEventListener('submit',handleLoanApplication);document.getElementById('dark-mode-toggle').addEventListener('change',toggleDarkMode);document.getElementById('delete-account-btn').addEventListener('click',deleteAccount)};const handleSignup=async(e)=>{e.preventDefault();const name=document.getElementById('signup-name').value;const email=document.getElementById('signup-email').value;const phone=document.getElementById('signup-phone').value;const password=document.getElementById('signup-password').value;try{const result=await firebase.auth().createUserWithEmailAndPassword(email,password);const uid=result.user.uid;await firebase.firestore().collection('users').doc(uid).set({name:name,email:email,phone:phone,balance:0,contributionAmount:0,participantCount:0,createdAt:new Date()});alert('Account created successfully!');showPage('login');document.getElementById('login-form').reset()}catch(error){alert('Error: '+error.message)}};const handleLogin=async(e)=>{e.preventDefault();const email=document.getElementById('login-email').value;const password=document.getElementById('login-password').value;try{await firebase.auth().signInWithEmailAndPassword(email,password);showPage('home');loadUserData();document.getElementById('login-form').reset()}catch(error){alert('Error: '+error.message)}};const handleLogout=async()=>{try{await firebase.auth().signOut();showPage('login');document.getElementById('login-form').reset()}catch(error){alert('Error: '+error.message)}};const handleDeposit=async(e)=>{e.preventDefault();const amount=parseFloat(document.getElementById('deposit-amount').value);const user=firebase.auth().currentUser;if(!user)return;const depositFee=10;const totalAmount=amount+depositFee;try{initiateFlutterwavePayment(totalAmount,amount,user.uid)}catch(error){alert('Error: '+error.message)}};const initiateFlutterwavePayment=(totalAmount,depositAmount,userId)=>{FlutterwaveCheckout({public_key:'FLWPUBK-16a72bd54f4eb876e6a705d899b049d8-X',tx_ref:'deposit_'+userId+'_'+Date.now(),amount:totalAmount,currency:'USD',payment_options:'card,mobilemoney,ussd',customer:{email:firebase.auth().currentUser.email,phone_number:firebase.auth().currentUser.phone||\'\'},customizations:{title:'RadarApp Deposit',description:'Deposit: $'+depositAmount+' + Fee: $10',logo:'https://yourapp.com/logo.png'},callback:async(data)=>{if(data.status==='successful'){const userRef=firebase.firestore().collection('users').doc(userId);const userDoc=await userRef.get();const currentBalance=userDoc.data().balance||0;await userRef.update({balance:currentBalance+depositAmount});await firebase.firestore().collection('transactions').add({userId:userId,type:'deposit',amount:depositAmount,fee:10,totalPaid:depositAmount+10,timestamp:new Date(),status:'completed'});alert('Deposit successful! Amount: $'+depositAmount);document.getElementById('deposit-form').reset();loadUserData()}else{alert('Payment failed')}},onclose:()=>{console.log('Payment dialog closed')}})};const handleContribution=async(e)=>{e.preventDefault();const participants=document.getElementById('participant-select').value;const amount=parseFloat(document.getElementById('contribution-amount').value);const user=firebase.auth().currentUser;if(!user)return;const monthlyCharge=30;const totalAmount=(amount*parseInt(participants))+monthlyCharge;try{initiateContributionPayment(totalAmount,amount,parseInt(participants),monthlyCharge,user.uid)}catch(error){alert('Error: '+error.message)}};const initiateContributionPayment=async(totalAmount,amount,participants,monthlyCharge,userId)=>{FlutterwaveCheckout({public_key:'FLWPUBK-16a72bd54f4eb876e6a705d899b049d8-X',tx_ref:'contribution_'+userId+'_'+Date.now(),amount:totalAmount,currency:'USD',payment_options:'card,mobilemoney,ussd',customer:{email:firebase.auth().currentUser.email},customizations:{title:'RadarApp Monthly Contribution',description:'Contribution: $'+(amount*participants)+' + Fee: $'+monthlyCharge},callback:async(data)=>{if(data.status==='successful'){await firebase.firestore().collection('contributions').add({userId:userId,amount:amount,participants:participants,monthlyCharge:monthlyCharge,totalPaid:totalAmount,timestamp:new Date(),dueDate:new Date(Date.now()+30*24*60*60*1000),status:'active'});await firebase.firestore().collection('transactions').add({userId:userId,type:'contribution',amount:amount*participants,fee:monthlyCharge,totalPaid:totalAmount,participants:participants,timestamp:new Date(),status:'completed'});alert('Monthly contribution set successfully!');document.getElementById('contribution-form').reset();loadUserData()}else{alert('Payment failed')}}})};const handleLoanApplication=async(e)=>{e.preventDefault();const loanAmount=parseFloat(document.getElementById('loan-amount').value);const daysToRepay=parseInt(document.getElementById('loan-days').value);const user=firebase.auth().currentUser;if(!user)return;if(loanAmount>1000000){alert('Loan amount cannot exceed $1,000,000');return}try{const dueDate=new Date();dueDate.setDate(dueDate.getDate()+daysToRepay);await firebase.firestore().collection('loans').add({userId:user.uid,amount:loanAmount,daysToRepay:daysToRepay,dueDate:dueDate,applicationDate:new Date(),status:'pending',interestRate:5});await firebase.firestore().collection('transactions').add({userId:user.uid,type:'loan_application',amount:loanAmount,daysToRepay:daysToRepay,timestamp:new Date(),status:'pending'});alert('Loan application submitted! Amount: $'+loanAmount+' | Due: '+dueDate.toDateString());document.getElementById('loan-form').reset();loadUserData()}catch(error){alert('Error: '+error.message)}};const loadUserData=async()=>{const user=firebase.auth().currentUser;if(!user)return;try{const userDoc=await firebase.firestore().collection('users').doc(user.uid).get();if(userDoc.exists){const userData=userDoc.data();document.getElementById('user-name').textContent=userData.name||'User';document.getElementById('user-email').textContent=user.email;document.getElementById('wallet-balance').textContent='$'+(userData.balance||0).toFixed(2);document.getElementById('contribution-amount-display').textContent='$'+(userData.contributionAmount||0).toFixed(2);document.getElementById('participant-count').textContent=userData.participantCount||0}loadTransactionRecords(user.uid)}catch(error){console.error('Error loading user data:',error)}};const loadTransactionRecords=async(userId)=>{try{const snapshot=await firebase.firestore().collection('transactions').where('userId','==',userId).orderBy('timestamp','desc').limit(20).get();const recordsList=document.getElementById('transaction-records');recordsList.innerHTML='';if(snapshot.empty){recordsList.innerHTML='<tr><td colspan="5">No transactions yet</td></tr>';return}snapshot.forEach(doc=>{const transaction=doc.data();const row=recordsList.insertRow();row.innerHTML=`<td>${transaction.type}</td><td>$${transaction.amount.toFixed(2)}</td><td>$${(transaction.fee||0).toFixed(2)}</td><td>${transaction.timestamp.toDate().toLocaleDateString()}</td><td>${transaction.status}</td>`})}catch(error){console.error('Error loading transactions:',error)}};const showPage=(pageName)=>{const pages=document.querySelectorAll('.page');pages.forEach(page=>page.style.display='none');const targetPage=document.getElementById(pageName+'-page');if(targetPage){targetPage.style.display='block'}};const toggleDarkMode=()=>{document.body.classList.toggle('dark-mode');const isDarkMode=document.body.classList.contains('dark-mode');localStorage.setItem('darkMode',isDarkMode)};const initializeDarkMode=()=>{const isDarkMode=localStorage.getItem('darkMode')==='true';if(isDarkMode){document.body.classList.add('dark-mode');document.getElementById('dark-mode-toggle').checked=true}};const deleteAccount=async()=>{const user=firebase.auth().currentUser;if(!user)return;const confirm=window.confirm('Are you sure you want to delete your account? This action cannot be undone.');if(!confirm)return;try{await firebase.firestore().collection('users').doc(user.uid).delete();await user.delete();alert('Account deleted successfully');showPage('login')}catch(error){alert('Error: '+error.message)}};window.addEventListener('load',initializeDarkMode);""")
PYEOF
head -20 web/app.js
